<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rulez.vip — Auto Rules + Creatives Analytics</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    .lp { max-width: 1100px; margin: 0 auto; padding: 28px 18px; }
    .lp-grid { display:grid; grid-template-columns: 1.2fr .8fr; gap:18px; align-items:start; }
    .lp-card { background:#0f1116; border:1px solid #222838; border-radius:16px; padding:16px; }
    .lp h1 { font-size:28px; margin:0 0 10px; }
    .muted { color:#a7b0c0; }
    .feat { display:grid; gap:10px; margin-top:12px; }
    .feat div { background:#0b0d12; border:1px solid #1f2533; border-radius:12px; padding:12px; }
    .form-row { display:flex; gap:10px; }
    .form-row > * { flex:1; }
    input { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2a3144; background:#0b0d12; color:#fff; }
    button { width:100%; padding:10px 12px; border-radius:10px; border:0; background:#3b82f6; color:#fff; cursor:pointer; }
    button.secondary { background:#1f2937; }
    .tabs { display:flex; gap:8px; margin-bottom:10px; }
    .tabbtn { padding:8px 10px; border-radius:10px; border:1px solid #2a3144; background:#0b0d12; color:#fff; cursor:pointer; }
    .tabbtn.active { background:#111827; border-color:#3b82f6; }
    .msg { margin-top:10px; font-size:14px; }
    .ok { color:#34d399; }
    .err { color:#fb7185; }
    a { color:#93c5fd; }
  </style>
</head>
<body>
  <div class="lp">
    <div class="lp-grid">
      <div class="lp-card">
        <h1>Rulez.vip — автоправила и аналитика креативов</h1>
        <p class="muted">
          Управляй рекламными кампаниями как в Bir.ch / Madgicx: авто-паузы, масштабирование, контроль бюджета и быстрый анализ креативов.
        </p>

        <div class="feat">
          <div><b>Аналитика креативов</b><br><span class="muted">Видео/картинки, метрики, сортировки, поиск.</span></div>
          <div><b>Управление кампаниями</b><br><span class="muted">Статусы, бюджет, действия по условиям.</span></div>
          <div><b>Масштабирование</b><br><span class="muted">Автоповышение/понижение бюджета по KPI.</span></div>
          <div><b>Trial на старте</b><br><span class="muted">Без оплаты, ограничение по фармам/кабинетам.</span></div>
        </div>

        <p class="muted" style="margin-top:12px">
          Уже есть аккаунт? Войди и продолжай в приложении.
        </p>
        <p><a href="/app">Перейти в приложение</a></p>
      </div>

      <div class="lp-card">
        <div class="tabs">
          <div class="tabbtn active" data-tab="login">Логин</div>
          <div class="tabbtn" data-tab="register">Регистрация</div>
          <div class="tabbtn" data-tab="reset">Восстановление</div>
        </div>

        <div id="tab-login">
          <div class="form-row">
            <input id="login-email" placeholder="Email" />
          </div>
          <div style="height:10px"></div>
          <div class="form-row">
            <input id="login-pass" placeholder="Пароль" type="password" />
          </div>
          <div style="height:10px"></div>
          <button id="btn-login">Войти</button>
          <div class="msg" id="login-msg"></div>
        </div>

        <div id="tab-register" style="display:none">
          <input id="reg-email" placeholder="Email" />
          <div style="height:10px"></div>
          <input id="reg-pass" placeholder="Пароль (мин 8 символов)" type="password" />
          <div style="height:10px"></div>
          <button id="btn-register">Создать аккаунт</button>
          <div class="msg" id="reg-msg"></div>

          <div style="height:14px"></div>
          <input id="verify-code" placeholder="Код из письма" />
          <div style="height:10px"></div>
          <button id="btn-verify" class="secondary">Подтвердить email</button>
          <div class="msg" id="verify-msg"></div>
        </div>

        <div id="tab-reset" style="display:none">
          <input id="reset-email" placeholder="Email" />
          <div style="height:10px"></div>
          <button id="btn-reset-request">Отправить код</button>
          <div class="msg" id="reset-msg"></div>

          <div style="height:14px"></div>
          <input id="reset-code" placeholder="Код из письма" />
          <div style="height:10px"></div>
          <input id="reset-newpass" placeholder="Новый пароль" type="password" />
          <div style="height:10px"></div>
          <button id="btn-reset-confirm" class="secondary">Сменить пароль</button>
          <div class="msg" id="reset2-msg"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  const $$ = (s) => document.querySelector(s);
  const setMsg = (id, text, ok) => {
    const el = $$(id);
    if (!el) return;
    el.textContent = text || '';
    el.className = 'msg ' + (ok ? 'ok' : 'err');
  };

  // tabs
  document.querySelectorAll('.tabbtn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tabbtn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.getAttribute('data-tab');
      ['login','register','reset'].forEach(t => {
        document.getElementById('tab-'+t).style.display = (t===tab) ? 'block' : 'none';
      });
    });
  });

  async function post(url, body) {
    const r = await fetch(url, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body || {})
    });
    const j = await r.json().catch(() => ({}));
    if (!r.ok) throw new Error(j.error || ('HTTP '+r.status));
    return j;
  }

  // register
  $$('#btn-register').addEventListener('click', async () => {
    setMsg('#reg-msg','',true);
    try {
      const email = $$('#reg-email').value.trim();
      const password = $$('#reg-pass').value;
      const j = await post('/api/auth/register', { email, password });
      setMsg('#reg-msg', j.message || 'Ок. Проверь почту, введи код ниже.', true);
    } catch(e) {
      setMsg('#reg-msg', e.message, false);
    }
  });

  // verify
  $$('#btn-verify').addEventListener('click', async () => {
    setMsg('#verify-msg','',true);
    try {
      const email = $$('#reg-email').value.trim();
      const code = $$('#verify-code').value.trim();
      const j = await post('/api/auth/verify', { email, code });
      setMsg('#verify-msg', j.message || 'Email подтвержден. Теперь логин.', true);
    } catch(e) {
      setMsg('#verify-msg', e.message, false);
    }
  });

  // login
  $$('#btn-login').addEventListener('click', async () => {
    setMsg('#login-msg','',true);
    try {
      const email = $$('#login-email').value.trim();
      const password = $$('#login-pass').value;
      const j = await post('/api/auth/login', { email, password });
      setMsg('#login-msg', j.message || 'Вошёл. Перехожу в приложение...', true);
      setTimeout(() => location.href = '/app', 400);
    } catch(e) {
      setMsg('#login-msg', e.message, false);
    }
  });

  // reset request
  $$('#btn-reset-request').addEventListener('click', async () => {
    setMsg('#reset-msg','',true);
    try {
      const email = $$('#reset-email').value.trim();
      const j = await post('/api/auth/reset/request', { email });
      setMsg('#reset-msg', j.message || 'Код отправлен на почту.', true);
    } catch(e) {
      setMsg('#reset-msg', e.message, false);
    }
  });

  // reset confirm
  $$('#btn-reset-confirm').addEventListener('click', async () => {
    setMsg('#reset2-msg','',true);
    try {
      const email = $$('#reset-email').value.trim();
      const code = $$('#reset-code').value.trim();
      const new_password = $$('#reset-newpass').value;
      const j = await post('/api/auth/reset/confirm', { email, code, new_password });
      setMsg('#reset2-msg', j.message || 'Пароль обновлён. Теперь логин.', true);
    } catch(e) {
      setMsg('#reset2-msg', e.message, false);
    }
  });
</script>
</body>
</html>
